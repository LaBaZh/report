## 实验目的和要求

### 实验目的

1. 掌握音符产生的方法，了解DDS技术的应用
2. 了解音频编解码的应用
3. 掌握系统”自顶向下“的数字系统设计方法

### 实验要求

设计出一个能够播放四首乐曲的音乐播放器，满足如下两个要求：

1. 设置play/pause_button、next_button、reset三个按键。play/pause_button按键实现乐曲在暂停与播放之间切换，按下next_button可以播放下一首乐曲；
2. 设置3个LED灯，LED0显示目前的播放状态(亮为播放，灭为暂停)，LED1和LED2显示目前乐曲号



## 实验内容和原理

### 主控制器模块

#### 功能说明

主控制器模块主要作用为响应用户按键信息、控制系统播放两大任务，算法流程图和书上类似，此处不表。

#### 主控制器代码

插入代码

### song_reader模块

#### 设计说明

song_reader模块任务如下：

1. 根据mcu模块的要求,选择播放乐曲。
2. 响应 note_player模块请求,从 song_rom中逐个取出音符{note, duration}送给note_player模块播放
3. 判断乐曲是否播放完毕,若播放完毕,则回复mcu模块应答信号。、

我们采用了书上给出的电路结构实现了上述功能，其中song_rom模块是一个只读存储器，用于存放乐曲；地址计数器计算播放的音符数，它的进位输出作为；结束判断模块利用地址计数器进位输出和从song_rom中取出的duration判断是否输出song_done信号。



#### 结束判断模块设计

结束判断模块采用了老师建议的状态机方法实现：

一、地址计数器进位输出co作为reset信号，duration单独输入，共四个状态实现，代码如下：

​	代码一

二、听了老师的介绍之后，意识到将两个信号按"duration == 0 || co"进行输入状态机会更加简单，如是将代码简化至如下：

​	代码二



#### song_reader控制器代码

​	代码



### note_player模块

#### 设计说明

音符播放模块note_ player是本实验的核心模块,它主要任务包括以下几方面。

1. 从 song_reader模块接收需播放的音符{note, duration}
2. 根据note值找出DDS的相位增量k
3. 以48kHz速率从 Sine_rom取出正弦样品送给音频编解码器接口模块
4. 当一个音符播放完成，向song_reader模块索取新的音符

进一步划分模块可将note_player划分为一下各个模块：作为控制单元的控制器、记录音符标记note和DD模块相位增量k查找表关系的FreqROM、DDS模块、音符节拍计时器。

下面给出控制器模块、DDS模块、节拍计时器、note_player代码

#### 代码

控制器代码

DDS代码

节拍计时器代码

note_player代码

### 同步化电路

#### 设计说明

因为音频解码接口模块和其他模块采用了不同的时钟，我们需要将二者进行同步化

#### 代码

同步化电路代码

## 主要仪器设备

1. 装有 Vivado和 ModelSim SE软件的计算机。
2.  Nexys Video Artix-7 FPGA多媒体音视频智能互联开发系统。
3. 有源音箱或耳机。



## 操作方法和实验步骤

1. 按照书中提供的框图，将音乐播放器次顶层划分为一下几个模块：主控制器、乐曲读取、音符播放、同步化电路以及节拍基准产生器

2. 参考实验15的资料，学习DDS技术相关知识，编写DDS模块并进行仿真
3. 根据书上的指导，依次编写剩下模块并进行仿真验证，测试其是否符合要求
4. 编写次顶层模块，并在其中设置参数sim方便仿真
5. 新建Vivado工程，生成符合要求的DCM模块，将自己编写的模块以及老师提供的网表文件及接口文件加入工程。对工程进行综合、约束、实现，并下载到开发板中进行验证

## 实验数据记录和处理

